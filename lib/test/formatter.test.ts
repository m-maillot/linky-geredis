import { describe, expect, test } from 'vitest';
import { formatLoadCurve } from '../formatter.js';
import measure1 from './data/api_response_consumption_short.json';
import measure2 from './data/api_response_consumption_long.json';
import type { GeredisApiResponse } from '../GeredisApiResponse.js';

describe('test du formatteur', () => {
  test('load curve sur une courte période', () => {
    const data: GeredisApiResponse = measure1;
    const result = formatLoadCurve(data);
    expect(result).toStrictEqual({
      reading_type: { aggregate: 'average', measurement_kind: 'power', unit: 'W' },
      end: '2024-09-29T16:00:00.000Z',
      interval_reading: [
        { value: '8000', date: '2024-09-27T01:00:00.000Z' },
        {
          value: '5000',
          date: '2024-09-27T16:00:00.000Z',
        },
        {
          value: '4000',
          date: '2024-09-28T01:00:00.000Z',
        },
        { value: '5000', date: '2024-09-28T16:00:00.000Z' },
        { value: '9000', date: '2024-09-29T01:00:00.000Z' },

        { value: '4000', date: '2024-09-29T16:00:00.000Z' },
      ],
      quality: '',
      start: '2024-09-27T01:00:00.000Z',
      usage_point_id: 'XXXXXXXX',
    });
  });

  test('load curve sur une longue période', () => {
    const data: GeredisApiResponse = measure2;
    const result = formatLoadCurve(data);
    expect(result).toStrictEqual({
      reading_type: { aggregate: 'average', measurement_kind: 'power', unit: 'W' },
      end: '2024-09-30T16:00:00.000Z',
      interval_reading: [
        { value: '6000', date: '2024-07-03T01:00:00.000Z' },
        {
          value: '12000',
          date: '2024-07-03T16:00:00.000Z',
        },
        { value: '9000', date: '2024-07-04T01:00:00.000Z' },
        {
          value: '7000',
          date: '2024-07-04T16:00:00.000Z',
        },
        { value: '10000', date: '2024-07-05T01:00:00.000Z' },
        {
          value: '5000',
          date: '2024-07-05T16:00:00.000Z',
        },
        { value: '12000', date: '2024-07-06T01:00:00.000Z' },
        {
          value: '8000',
          date: '2024-07-06T16:00:00.000Z',
        },
        { value: '4000', date: '2024-07-07T01:00:00.000Z' },
        {
          value: '7000',
          date: '2024-07-07T16:00:00.000Z',
        },
        { value: '9000', date: '2024-07-08T01:00:00.000Z' },
        {
          value: '5000',
          date: '2024-07-08T16:00:00.000Z',
        },
        { value: '6000', date: '2024-07-09T01:00:00.000Z' },
        {
          value: '7000',
          date: '2024-07-09T16:00:00.000Z',
        },
        { value: '8000', date: '2024-07-10T01:00:00.000Z' },
        {
          value: '7000',
          date: '2024-07-10T16:00:00.000Z',
        },
        { value: '11000', date: '2024-07-11T01:00:00.000Z' },
        {
          value: '5000',
          date: '2024-07-11T16:00:00.000Z',
        },
        { value: '8000', date: '2024-07-12T01:00:00.000Z' },
        {
          value: '7000',
          date: '2024-07-12T16:00:00.000Z',
        },
        { value: '10000', date: '2024-07-13T01:00:00.000Z' },
        {
          value: '14000',
          date: '2024-07-13T16:00:00.000Z',
        },
        { value: '4000', date: '2024-07-14T01:00:00.000Z' },
        {
          value: '8000',
          date: '2024-07-14T16:00:00.000Z',
        },
        { value: '4000', date: '2024-07-15T01:00:00.000Z' },
        {
          value: '6000',
          date: '2024-07-15T16:00:00.000Z',
        },
        { value: '9000', date: '2024-07-16T01:00:00.000Z' },
        {
          value: '6000',
          date: '2024-07-16T16:00:00.000Z',
        },
        { value: '6000', date: '2024-07-17T01:00:00.000Z' },
        {
          value: '7000',
          date: '2024-07-17T16:00:00.000Z',
        },
        { value: '9000', date: '2024-07-18T01:00:00.000Z' },
        {
          value: '6000',
          date: '2024-07-18T16:00:00.000Z',
        },
        { value: '6000', date: '2024-07-19T01:00:00.000Z' },
        {
          value: '4000',
          date: '2024-07-19T16:00:00.000Z',
        },
        { value: '9000', date: '2024-07-20T01:00:00.000Z' },
        {
          value: '4000',
          date: '2024-07-20T16:00:00.000Z',
        },
        { value: '3000', date: '2024-07-21T01:00:00.000Z' },
        {
          value: '5000',
          date: '2024-07-21T16:00:00.000Z',
        },
        { value: '10000', date: '2024-07-22T01:00:00.000Z' },
        {
          value: '7000',
          date: '2024-07-22T16:00:00.000Z',
        },
        { value: '5000', date: '2024-07-23T01:00:00.000Z' },
        {
          value: '6000',
          date: '2024-07-23T16:00:00.000Z',
        },
        { value: '10000', date: '2024-07-24T01:00:00.000Z' },
        {
          value: '4000',
          date: '2024-07-24T16:00:00.000Z',
        },
        { value: '8000', date: '2024-07-25T01:00:00.000Z' },
        {
          value: '8000',
          date: '2024-07-25T16:00:00.000Z',
        },
        { value: '5000', date: '2024-07-26T01:00:00.000Z' },
        {
          value: '6000',
          date: '2024-07-26T16:00:00.000Z',
        },
        { value: '7000', date: '2024-07-27T01:00:00.000Z' },
        {
          value: '11000',
          date: '2024-07-27T16:00:00.000Z',
        },
        { value: '9000', date: '2024-07-28T01:00:00.000Z' },
        {
          value: '7000',
          date: '2024-07-28T16:00:00.000Z',
        },
        { value: '7000', date: '2024-07-29T01:00:00.000Z' },
        {
          value: '6000',
          date: '2024-07-29T16:00:00.000Z',
        },
        { value: '7000', date: '2024-07-30T01:00:00.000Z' },
        {
          value: '6000',
          date: '2024-07-30T16:00:00.000Z',
        },
        { value: '5000', date: '2024-07-31T01:00:00.000Z' },
        {
          value: '7000',
          date: '2024-07-31T16:00:00.000Z',
        },
        { value: '4000', date: '2024-08-01T01:00:00.000Z' },
        {
          value: '8000',
          date: '2024-08-01T16:00:00.000Z',
        },
        { value: '8000', date: '2024-08-02T01:00:00.000Z' },
        {
          value: '4000',
          date: '2024-08-02T16:00:00.000Z',
        },
        { value: '9000', date: '2024-08-03T01:00:00.000Z' },
        {
          value: '5000',
          date: '2024-08-03T16:00:00.000Z',
        },
        { value: '6000', date: '2024-08-04T01:00:00.000Z' },
        {
          value: '4000',
          date: '2024-08-04T16:00:00.000Z',
        },
        { value: '4000', date: '2024-08-05T01:00:00.000Z' },
        {
          value: '7000',
          date: '2024-08-05T16:00:00.000Z',
        },
        { value: '5000', date: '2024-08-06T01:00:00.000Z' },
        {
          value: '10000',
          date: '2024-08-06T16:00:00.000Z',
        },
        { value: '11000', date: '2024-08-07T01:00:00.000Z' },
        {
          value: '5000',
          date: '2024-08-07T16:00:00.000Z',
        },
        { value: '4000', date: '2024-08-08T01:00:00.000Z' },
        {
          value: '6000',
          date: '2024-08-08T16:00:00.000Z',
        },
        { value: '8000', date: '2024-08-09T01:00:00.000Z' },
        {
          value: '4000',
          date: '2024-08-09T16:00:00.000Z',
        },
        { value: '4000', date: '2024-08-10T01:00:00.000Z' },
        {
          value: '5000',
          date: '2024-08-10T16:00:00.000Z',
        },
        { value: '5000', date: '2024-08-11T01:00:00.000Z' },
        {
          value: '4000',
          date: '2024-08-11T16:00:00.000Z',
        },
        { value: '8000', date: '2024-08-12T01:00:00.000Z' },
        {
          value: '5000',
          date: '2024-08-12T16:00:00.000Z',
        },
        { value: '4000', date: '2024-08-13T01:00:00.000Z' },
        {
          value: '6000',
          date: '2024-08-13T16:00:00.000Z',
        },
        { value: '4000', date: '2024-08-14T01:00:00.000Z' },
        {
          value: '5000',
          date: '2024-08-14T16:00:00.000Z',
        },
        { value: '11000', date: '2024-08-15T01:00:00.000Z' },
        {
          value: '5000',
          date: '2024-08-15T16:00:00.000Z',
        },
        { value: '4000', date: '2024-08-16T01:00:00.000Z' },
        {
          value: '6000',
          date: '2024-08-16T16:00:00.000Z',
        },
        { value: '8000', date: '2024-08-17T01:00:00.000Z' },
        {
          value: '6000',
          date: '2024-08-17T16:00:00.000Z',
        },
        { value: '4000', date: '2024-08-18T01:00:00.000Z' },
        {
          value: '7000',
          date: '2024-08-18T16:00:00.000Z',
        },
        { value: '5000', date: '2024-08-19T01:00:00.000Z' },
        {
          value: '4000',
          date: '2024-08-19T16:00:00.000Z',
        },
        { value: '5000', date: '2024-08-20T01:00:00.000Z' },
        {
          value: '3000',
          date: '2024-08-20T16:00:00.000Z',
        },
        { value: '4000', date: '2024-08-21T01:00:00.000Z' },
        {
          value: '5000',
          date: '2024-08-21T16:00:00.000Z',
        },
        { value: '6000', date: '2024-08-22T01:00:00.000Z' },
        {
          value: '2000',
          date: '2024-08-22T16:00:00.000Z',
        },
        { value: '3000', date: '2024-08-23T01:00:00.000Z' },
        {
          value: '4000',
          date: '2024-08-23T16:00:00.000Z',
        },
        { value: '12000', date: '2024-08-24T01:00:00.000Z' },
        {
          value: '6000',
          date: '2024-08-24T16:00:00.000Z',
        },
        { value: '5000', date: '2024-08-25T01:00:00.000Z' },
        {
          value: '4000',
          date: '2024-08-25T16:00:00.000Z',
        },
        { value: '9000', date: '2024-08-26T01:00:00.000Z' },
        {
          value: '4000',
          date: '2024-08-26T16:00:00.000Z',
        },
        { value: '7000', date: '2024-08-27T01:00:00.000Z' },
        {
          value: '5000',
          date: '2024-08-27T16:00:00.000Z',
        },
        { value: '7000', date: '2024-08-28T01:00:00.000Z' },
        {
          value: '6000',
          date: '2024-08-28T16:00:00.000Z',
        },
        { value: '10000', date: '2024-08-29T01:00:00.000Z' },
        {
          value: '6000',
          date: '2024-08-29T16:00:00.000Z',
        },
        { value: '5000', date: '2024-08-30T01:00:00.000Z' },
        {
          value: '6000',
          date: '2024-08-30T16:00:00.000Z',
        },
        { value: '7000', date: '2024-08-31T01:00:00.000Z' },
        {
          value: '5000',
          date: '2024-08-31T16:00:00.000Z',
        },
        { value: '7000', date: '2024-09-01T01:00:00.000Z' },
        {
          value: '4000',
          date: '2024-09-01T16:00:00.000Z',
        },
        { value: '6000', date: '2024-09-02T01:00:00.000Z' },
        {
          value: '4000',
          date: '2024-09-02T16:00:00.000Z',
        },
        { value: '6000', date: '2024-09-03T01:00:00.000Z' },
        {
          value: '5000',
          date: '2024-09-03T16:00:00.000Z',
        },
        { value: '7000', date: '2024-09-04T01:00:00.000Z' },
        {
          value: '0',
          date: '2024-09-04T16:00:00.000Z',
        },
        { value: '5000', date: '2024-09-05T01:00:00.000Z' },
        {
          value: '9000',
          date: '2024-09-05T16:00:00.000Z',
        },
        { value: '7000', date: '2024-09-06T01:00:00.000Z' },
        {
          value: '4000',
          date: '2024-09-06T16:00:00.000Z',
        },
        { value: '7000', date: '2024-09-07T01:00:00.000Z' },
        {
          value: '5000',
          date: '2024-09-07T16:00:00.000Z',
        },
        { value: '9000', date: '2024-09-08T01:00:00.000Z' },
        {
          value: '3000',
          date: '2024-09-08T16:00:00.000Z',
        },
        { value: '4000', date: '2024-09-09T01:00:00.000Z' },
        {
          value: '4000',
          date: '2024-09-09T16:00:00.000Z',
        },
        { value: '13000', date: '2024-09-10T01:00:00.000Z' },
        {
          value: '4000',
          date: '2024-09-10T16:00:00.000Z',
        },
        { value: '6000', date: '2024-09-11T01:00:00.000Z' },
        {
          value: '6000',
          date: '2024-09-11T16:00:00.000Z',
        },
        { value: '10000', date: '2024-09-12T01:00:00.000Z' },
        {
          value: '3000',
          date: '2024-09-12T16:00:00.000Z',
        },
        { value: '4000', date: '2024-09-13T01:00:00.000Z' },
        {
          value: '4000',
          date: '2024-09-13T16:00:00.000Z',
        },
        { value: '8000', date: '2024-09-14T01:00:00.000Z' },
        {
          value: '14000',
          date: '2024-09-14T16:00:00.000Z',
        },
        { value: '4000', date: '2024-09-15T01:00:00.000Z' },
        {
          value: '4000',
          date: '2024-09-15T16:00:00.000Z',
        },
        { value: '9000', date: '2024-09-16T01:00:00.000Z' },
        {
          value: '5000',
          date: '2024-09-16T16:00:00.000Z',
        },
        { value: '11000', date: '2024-09-17T01:00:00.000Z' },
        {
          value: '10000',
          date: '2024-09-17T16:00:00.000Z',
        },
        { value: '5000', date: '2024-09-18T01:00:00.000Z' },
        {
          value: '8000',
          date: '2024-09-18T16:00:00.000Z',
        },
        { value: '8000', date: '2024-09-19T01:00:00.000Z' },
        {
          value: '8000',
          date: '2024-09-19T16:00:00.000Z',
        },
        { value: '9000', date: '2024-09-20T01:00:00.000Z' },
        {
          value: '6000',
          date: '2024-09-20T16:00:00.000Z',
        },
        { value: '7000', date: '2024-09-21T01:00:00.000Z' },
        {
          value: '8000',
          date: '2024-09-21T16:00:00.000Z',
        },
        { value: '5000', date: '2024-09-22T01:00:00.000Z' },
        {
          value: '7000',
          date: '2024-09-22T16:00:00.000Z',
        },
        { value: '11000', date: '2024-09-23T01:00:00.000Z' },
        {
          value: '11000',
          date: '2024-09-23T16:00:00.000Z',
        },
        { value: '7000', date: '2024-09-24T01:00:00.000Z' },
        {
          value: '6000',
          date: '2024-09-24T16:00:00.000Z',
        },
        { value: '8000', date: '2024-09-25T01:00:00.000Z' },
        {
          value: '12000',
          date: '2024-09-25T16:00:00.000Z',
        },
        { value: '9000', date: '2024-09-26T01:00:00.000Z' },
        {
          value: '6000',
          date: '2024-09-26T16:00:00.000Z',
        },
        { value: '8000', date: '2024-09-27T01:00:00.000Z' },
        {
          value: '5000',
          date: '2024-09-27T16:00:00.000Z',
        },
        { value: '4000', date: '2024-09-28T01:00:00.000Z' },
        {
          value: '5000',
          date: '2024-09-28T16:00:00.000Z',
        },
        { value: '9000', date: '2024-09-29T01:00:00.000Z' },
        {
          value: '4000',
          date: '2024-09-29T16:00:00.000Z',
        },
        { value: '10000', date: '2024-09-30T01:00:00.000Z' },
        {
          value: '6000',
          date: '2024-09-30T16:00:00.000Z',
        },
      ],
      quality: '',
      start: '2024-07-03T01:00:00.000Z',
      usage_point_id: 'XXXXX',
    });
  });
});
